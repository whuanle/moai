version: '3.8'

services:
  # 后端服务
  moaiapi:
    build:
      context: ./src/MoAI
      dockerfile: Dockerfile
    container_name: moaiapi
    ports:
      - "5000:8080"
    volumes:
      - ./configs:/app/config
    environment:
      - MAI_FILE=/app/config/system.json # 部署时请务必提前配置
      - ASPNETCORE_ENVIRONMENT=Production
      - ASPNETCORE_URLS=http://+:8080
    restart: unless-stopped
    networks:
      - moai-network

  # 前端服务
  miaifront:
    build:
      context: ./ui/moai
      dockerfile: Dockerfile
      target: production
      args:
        VITE_ServerUrl: __BACKEND_URL_PLACEHOLDER__
    container_name: miaifront
    ports:
      - "3000:80"
    environment:
      - NODE_ENV=production
      - BACKEND_URL=${BACKEND_URL:-http://moaiapi:8080} # 部署时请务必修改为实际的后端地址
    restart: unless-stopped
    depends_on:
      - moaiapi
    networks:
      - moai-network

networks:
  moai-network:
    driver: bridge

volumes:
  configs:
    driver: local 
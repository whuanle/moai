# 工作流编辑器 - 快速开始

## 如何测试

### 方式一：在现有页面中使用

工作流编辑器已经集成到团队应用管理中，访问路径：

```
/app/team/{teamId}/workflow/{workflowId}
```

### 方式二：独立测试

如果需要独立测试，可以创建一个测试页面：

```tsx
// src/components/team/apps/workflow/TestPage.tsx
import { WorkflowEditor } from './WorkflowEditor';

export function WorkflowTestPage() {
  return (
    <div style={{ height: '100vh' }}>
      <WorkflowEditor />
    </div>
  );
}
```

或者使用完整的 WorkflowConfig 组件：

```tsx
import WorkflowConfig from './WorkflowConfig';

export function WorkflowTestPage() {
  return <WorkflowConfig />;
}
```

## 功能测试清单

### 1. 节点拖拽测试

#### 控制流节点
- [ ] 拖拽"开始"节点到画布
- [ ] 拖拽"结束"节点到画布
- [ ] 拖拽"条件判断"节点到画布
- [ ] 拖拽"并行分支"节点到画布
- [ ] 拖拽"循环遍历"节点到画布

#### AI 节点
- [ ] 拖拽"AI 对话"节点到画布

#### 数据处理节点
- [ ] 拖拽"数据处理"节点到画布
- [ ] 拖拽"JavaScript"节点到画布

#### 集成节点
- [ ] 拖拽"插件调用"节点到画布
- [ ] 拖拽"知识库查询"节点到画布

### 2. 搜索功能测试

- [ ] 在搜索框输入"AI"，验证只显示 AI 相关节点
- [ ] 在搜索框输入"数据"，验证显示数据处理相关节点
- [ ] 在搜索框输入"判断"，验证显示条件判断节点
- [ ] 清空搜索，验证显示所有节点
- [ ] 输入不存在的关键词，验证显示空状态

### 3. 节点操作测试

- [ ] 在节点上右键，验证菜单显示
- [ ] 点击"复制节点"，验证节点被复制到偏移位置
- [ ] 点击"删除节点"，验证节点被删除
- [ ] 点击"编辑节点"，验证提示"功能开发中"

### 4. 画布操作测试

- [ ] 按住鼠标左键拖动画布
- [ ] 使用鼠标滚轮缩放画布
- [ ] 点击右下角缩放控制器的"+"按钮放大
- [ ] 点击右下角缩放控制器的"-"按钮缩小
- [ ] 点击"适应视图"按钮，验证画布自动调整

### 5. 工具栏测试

- [ ] 点击"保存"按钮，验证控制台输出工作流数据
- [ ] 点击"运行"按钮，验证提示"功能开发中"

### 6. 缩略图测试

- [ ] 验证右下角显示缩略图
- [ ] 在缩略图中拖动视口，验证画布跟随移动
- [ ] 在画布中移动，验证缩略图视口跟随更新

## 预期行为

### 节点创建
1. 从左侧面板拖拽节点
2. 在画布上释放鼠标
3. 节点出现在鼠标释放位置
4. 显示成功消息："已添加 {节点名称} 节点"
5. 节点 ID 格式：`{nodeType}_{timestamp}`

### 节点显示
- 节点标题栏显示节点名称
- 节点标题栏颜色与节点类型对应
- 节点图标显示在标题栏左侧
- 节点内容区域显示节点描述

### 节点端口
- 开始节点：只有输出端口（右侧）
- 结束节点：只有输入端口（左侧）
- 条件判断节点：1个输入端口，2个输出端口
- 并行分支节点：1个输入端口，2个输出端口
- 其他节点：1个输入端口，1个输出端口

### 搜索行为
- 实时过滤，无需按回车
- 大小写不敏感
- 匹配节点名称或描述
- 空结果时显示所有分类但无节点

### 右键菜单
- 在节点上右键打开菜单
- 菜单包含：编辑、复制、删除
- 删除选项显示为红色（危险操作）

## 常见问题

### Q: 拖拽节点后没有反应？
A: 检查以下几点：
1. 确保画布组件正确渲染
2. 检查浏览器控制台是否有错误
3. 确认 @flowgram.ai/free-layout-editor 已正确安装

### Q: 节点删除失败？
A: 这可能是由于 @flowgram.ai/free-layout-editor 版本差异。代码已实现多种删除方法的兼容处理。如果仍然失败，请检查控制台错误信息。

### Q: 搜索不工作？
A: 确保：
1. 输入框有焦点
2. 输入的是中文或英文关键词
3. 关键词存在于节点名称或描述中

### Q: 画布无法拖动？
A: 检查：
1. 是否在节点上拖动（节点会移动）
2. 是否在空白区域拖动（画布会移动）
3. 编辑器配置中 `enablePan` 是否为 true

## 调试技巧

### 查看工作流数据
打开浏览器控制台，点击"保存"按钮，查看输出的工作流 JSON 数据。

### 查看节点数据
在 `useEditorProps.tsx` 的 `onContentChange` 回调中可以看到每次数据变更。

### 查看节点模板
```typescript
import { nodeTemplates } from './nodeTemplates';
console.log(nodeTemplates);
```

### 查看节点注册表
```typescript
import { nodeRegistries } from './nodeRegistries';
console.log(nodeRegistries);
```

## 性能测试

### 节点数量测试
1. 创建 10 个节点，验证流畅度
2. 创建 50 个节点，验证流畅度
3. 创建 100 个节点，验证流畅度

### 拖拽性能测试
1. 快速拖拽多个节点
2. 验证是否有卡顿
3. 验证节点位置是否准确

### 搜索性能测试
1. 快速输入和删除搜索关键词
2. 验证过滤是否实时
3. 验证是否有延迟

## 下一步

测试完成后，可以开始实现：
1. 节点配置面板
2. 节点连接功能
3. 工作流保存和加载
4. 工作流执行功能

## 反馈

如果发现问题或有改进建议，请：
1. 记录问题详情（步骤、预期、实际）
2. 截图或录屏
3. 查看控制台错误信息
4. 提交问题报告

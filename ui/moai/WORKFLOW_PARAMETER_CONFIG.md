# 工作流节点参数配置系统

## 功能概述

实现了工作流节点的输入输出参数配置系统，支持：

### 1. 节点基本配置
- **节点 Key**：唯一标识符，用于在工作流中引用节点（支持字母、数字、下划线、横线）
- **节点名称**：显示名称
- **节点描述**：详细说明

### 2. 参数类型
- **String**（字符串）
- **Number**（数字）
- **Boolean**（布尔值）
- **Object**（对象，支持嵌套字段）
- **Array**（数组）
- **Map**（映射，不支持详细字段设计）
- **Dynamic**（动态类型）

### 3. 参数配置
- 字段名称
- 字段类型
- 字段描述
- 嵌套字段（Object 和 Array 类型）

### 4. 嵌套字段
- Object 和 Array 类型支持添加子字段
- Map 类型不支持子字段设计
- 子字段使用 `a.b` 格式扁平化存储

## 使用方式

### 1. 画布显示

节点在画布上会显示其输入输出参数信息（只读）：

```
┌─────────────────┐
│   开始节点      │
├─────────────────┤
│ 输入:           │
│ 输出:           │
│  parameters Map │
└─────────────────┘
```

### 2. 编辑参数

双击节点或右键选择"编辑节点"，在侧边栏配置面板中：

- **基本信息** 标签页：配置节点 Key、名称、描述和特定设置
- **输入参数** 标签页：配置输入参数
- **输出参数** 标签页：配置输出参数

### 3. 侧边栏功能

- **可拖动调整宽度**：拖动左侧边缘可调整面板宽度（400px - 1200px）
- **优美的 UI 设计**：
  - 带图标和颜色的头部
  - 分区块的配置区域
  - 响应式布局
  - 平滑过渡动画

### 4. 添加参数

1. 点击"添加参数"按钮
2. 输入字段名称
3. 选择字段类型
4. 输入字段描述

### 5. 嵌套字段

对于 Object 和 Array 类型：

1. 点击"子字段"按钮
2. 配置子字段信息
3. 子字段会显示完整路径（如 `parent.child`）

## 数据结构

### FieldDefine（字段定义）

```typescript
interface FieldDefine {
  fieldName: string;        // 字段名
  fieldType: FieldType;     // 字段类型
  isRequired?: boolean;     // 是否必填（已移除，不再使用）
  description?: string;     // 字段描述
  defaultValue?: any;       // 默认值
  children?: FieldDefine[]; // 子字段（仅 Object/Array）
}
```

### 扁平化存储

嵌套字段会被扁平化为 `a.b` 格式存储到后端：

```typescript
// 原始结构
{
  user: {
    type: 'object',
    children: [
      { fieldName: 'name', fieldType: 'string' },
      { fieldName: 'age', fieldType: 'number' }
    ]
  }
}

// 扁平化后
{
  'user': { fieldType: 'object' },
  'user.name': { fieldType: 'string' },
  'user.age': { fieldType: 'number' }
}
```

## 文件说明

### 新增文件

1. **ParameterConfig.tsx**
   - 参数配置组件
   - 支持添加、删除、编辑参数
   - 支持嵌套字段配置
   - 提供 `flattenFields` 和 `unflattenFields` 工具函数

2. **ParameterConfig.css**
   - 参数配置组件样式
   - 响应式布局
   - 优化的输入框和按钮样式

3. **ConfigPanel.css**
   - 配置面板样式
   - 拖动调整宽度的手柄样式
   - 配置区块样式

### 修改文件

1. **ConfigPanel.tsx**
   - 添加节点 Key 配置（带唯一性验证）
   - 添加输入输出参数配置标签页
   - 使用三个独立的 Form 实例管理不同标签页
   - 支持拖动调整面板宽度
   - 优化 UI 设计（带图标的头部）
   - 保存时扁平化字段定义

2. **WorkflowEditor.tsx**
   - 更新节点渲染器，显示输入输出参数

3. **WorkflowEditor.css**
   - 添加节点参数显示样式

## 改进点

### 1. 移除启动参数配置
- 开始节点和结束节点没有额外的特殊配置
- 所有配置通过输入输出参数统一管理

### 2. 节点 Key 唯一性验证
- 每个节点必须有唯一的 Key
- Key 只能包含字母、数字、下划线和横线
- 保存时自动验证 Key 是否冲突

### 3. 移除必填/可选选项
- 输入参数不再显示必填/可选选择器
- 简化参数配置界面

### 4. 可拖动调整宽度
- 侧边栏面板支持拖动左侧边缘调整宽度
- 宽度范围：400px - 1200px
- 拖动时显示蓝色指示线

### 5. 优化 UI 设计
- 带颜色图标的面板头部
- 分区块的配置区域（带标题和边框）
- 优化的表单布局和间距
- 响应式设计

## 注意事项

1. Map 类型不支持详细字段设计（按需求）
2. 所有嵌套字段统一按照 `a.b` 格式扁平化
3. 配置面板的 Drawer 设置了 `maskClosable={false}`，防止误关闭
4. 节点 Key 必须唯一，保存时会自动验证
5. 当前实现为基础版本，后续可逐步优化

## 后续优化建议

1. 支持更多字段类型（Date、File 等）
2. 支持字段验证规则配置
3. 支持字段默认值配置
4. 支持从其他节点输出引用参数
5. 支持参数表达式编辑器
6. 支持参数模板和预设
7. 支持参数拖拽排序
8. 支持参数批量导入导出
